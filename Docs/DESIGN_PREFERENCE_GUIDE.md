# 系统设计原则

## 核心原则

### 1. 简洁与明确
- 设计简明扼要，结构清晰，避免冗余
- 仅保留核心功能，非关键细节留给上层实现
- 优先选择可读性强、维护成本低的方案
- 避免过度工程化，按需求驱动设计

### 2. 约束与边界清晰  
- 明确服务边界和"不做的内容"
- 约束条件在文档中显式声明，防止需求膨胀
- 模块职责单一，避免功能重叠和耦合
- 通过接口定义明确服务契约

### 3. 灵活扩展
- 预留扩展点（多租户、优先级、标签等）
- 参数、结果、异常结构不做强约束
- 使用配置驱动支持不同部署环境
- 采用插件化架构支持动态加载

## 技术选型

### .NET 6 生态整合
- 充分利用 .NET 6 新特性（隐式using、全局using）
- 使用标准Microsoft.Extensions.*系列包
- 遵循 ASP.NET Core 约定和最佳实践
- 采用标准配置、日志、依赖注入模式

### 主流标准依赖
- 技术选型优先主流、标准化方案
- 遵循行业最佳实践，便于团队协作
- 选择生态成熟、社区活跃的技术
- 避免引入过于前沿或实验性技术

## 数据库开发规范 ⭐

### Entity Framework Core 迁移管理
- **⚠️ 重要约束**: 开发过程中禁止自动创建数据库迁移
- **手动控制**: 所有数据库结构变更必须经过人工审核和确认
- **分阶段执行**: 采用渐进式数据库变更策略，确保生产环境安全
- **版本控制**: 迁移文件纳入严格的版本控制和代码审查流程

### 数据库变更最佳实践
```csharp
// ❌ 禁止：自动生成迁移
// dotnet ef migrations add AutoGenerated --context PowerLmsUserDbContext

// ✅ 推荐：手动规划和创建迁移
// 1. 先完成实体类设计和代码审查
// 2. 人工规划数据库变更策略
// 3. 手动创建迁移文件并测试
// 4. 在开发环境充分验证后再部署
```

### 数据模型设计约束
- **向后兼容**: 新增字段必须设置默认值或允许NULL
- **渐进删除**: 废弃字段先标记 `[Obsolete]`，后续版本再物理删除
- **影响评估**: 结构变更前必须评估对现有业务的影响
- **回滚计划**: 每次数据库变更都要准备回滚方案

## 可维护性与可追溯性

### 数据持久化
- 任务与操作完整持久化，便于查询溯源
- 关键业务操作记录操作人、操作时间
- 数据修改采用软删除，保留历史痕迹
- 重要配置变更需要版本控制和回滚

### 日志与监控
- 日志分级明确，异常信息完整保存
- 使用结构化日志，便于分析查询
- 关键业务指标监控告警
- 提供完整调用链追踪

## 安全与权限

### 身份认证与授权
- 基于角色和权限的访问控制模型
- 支持多租户数据隔离（OrgId实现数据边界）
- 敏感操作需要额外权限验证
- 关键字段修改保护机制

### 数据安全
- 审计字段不可变性保证
- 敏感信息日志脱敏处理
- 数据传输和存储加密保护

## 性能与资源

### 性能策略
- 不主动考虑大规模性能优化
- 前期以易用、稳定为主
- 采用渐进式优化，避免过早优化
- 通过监控数据指导优化方向

### 资源管理
- 合理使用缓存减少数据库压力
- 采用连接池管理数据库连接
- 及时释放系统资源，避免内存泄漏
- 使用分页查询处理大数据集

---
*本指南基于 .NET 6 生态和现代软件架构最佳实践制定*