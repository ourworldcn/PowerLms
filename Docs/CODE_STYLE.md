# 代码规范和风格

## 一、命名规范

- **私有字段**：使用 `_PascalCase` 格式，如 `_ServiceProvider`，并附加行尾注释。
- **公共成员**：使用 `PascalCase` 格式，名称具描述性。
- **枚举值**：如用于位标志，首选值为 1, 2, 4, 8 等（2 的幂）。

## 二、代码结构

- 使用 `#region` 分隔代码区块。
- 按功能和访问修饰符组织成员。
- 公共接口与内部实现明确分离。
- 偏好单一功能的小型方法。

## 三、注释风格

- XML 文档注释保持在同一行，并以句号结尾。
- 行尾注释说明实现细节。
- 详细记录参数、返回值和功能。

## 四、技术偏好

- **异步编程**：偏好同步实现或手动管理线程，避免 `async/await`。
- **并发控制**：使用 `SemaphoreSlim` 控制并发访问。
- **数据库交互**：
  - 使用 `[NotMapped]` 标记非数据库字段。
  - 避免在实体中直接使用枚举，使用基础类型并提供转换属性。
  - 设置适当索引提升查询性能。

## 五、设计模式与架构

- 依赖注入：通过构造函数参数注入依赖。
- 扩展方法：增强现有类型功能，简化服务注册。
- 领域驱动设计：实体类与服务分离，业务逻辑与数据访问层区分。

## 六、错误处理

- 使用 `try-catch` 块包装可能失败的操作。
- 详细记录异常信息，包括完整的异常层次。
- 使用结构化日志记录，区分不同日志级别。

## 七、性能考量

- 使用 `using` 语句确保资源及时释放。
- 限制时间类型精度（如精确到毫秒）以节省存储空间。
- 使用 JSON 序列化存储复杂数据结构，提供类型安全的访问接口。

---