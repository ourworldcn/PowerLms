# PowerLms 系统架构与基础设施

## 🏗️ **已有基础设施组件**

### 📁 通用文件管理系统
- **服务类**: `OwFileService`
- **功能特性**: 
  - 完整的文件存储和权限控制
  - 支持文件上传、下载、删除
  - 文件访问权限验证
  - 文件元数据管理
- **使用位置**: 日常费用申请单的发票文件上传等
- **状态**: ✅ 已完成，生产就绪

### 🔄 审批工作流引擎
- **服务类**: `OwWfManager` 
- **核心实体**:
  - `OwWfTemplate` - 工作流模板
  - `OwWfTemplateNode` - 节点定义
  - `OwWfTemplateNodeItem` - 节点详细信息
- **功能特性**:
  - 多级审批流程支持
  - 动态审批人分配
  - 审批状态跟踪
  - 流程模板配置
- **状态映射**:
  ```
  0 = 流转中 → wfState = 3
  1 = 成功完成 → wfState = 4  
  2 = 已被终止 → wfState = 8
  ```
- **使用场景**: 
  - 日常费用申请审批
  - 业务单据审核流程
  - 市场计划审批
- **状态**: ✅ 已完成，生产就绪

### 🔐 权限管理系统
- **服务类**: `AuthorizationManager`
- **权限结构**: 
  - 数百个细粒度权限节点
  - 多层级权限控制 (A.1.1 格式)
  - 基于角色和组织的访问控制
- **多租户支持**: 通过 `OrgId` 实现数据隔离
- **状态**: ✅ 已完成，生产就绪

## 📋 **业务模块状态总览**

### ✅ 已完成模块
- **基础数据管理**: 客户、港口、航线、费用种类等
- **工作号管理**: 完整的工作号生命周期
- **费用管理**: 复杂的费用核算体系
- **结算开票**: 财务结算和发票生成
- **金蝶集成**: 财务凭证自动生成
- **OA日常费用**: 申请单CRUD、审批流程、凭证生成

### 🚧 进行中模块  
- **基础工具类重构**: OwStringUtils 优化
- **前端开发**: 独立前端团队开发中

### 📋 规划中模块
- **监控系统**: 业务指标监控
- **自动化测试**: CI/CD流程完善

## 🎯 **关键设计原则**

### 基础设施复用优先
> **重要**: 新功能开发必须优先考虑复用已有基础设施：
> - 文件操作 → 使用 `OwFileService`
> - 审批流程 → 使用 `OwWfManager`  
> - 权限控制 → 使用 `AuthorizationManager`
> - 不要重复造轮子！

### 数据一致性保证
- 所有业务数据使用 `OrgId` 进行多租户隔离
- 审计字段 (`CreateBy`, `CreateDateTime`) 统一处理
- 软删除策略保证数据完整性

### API设计规范
- RESTful API设计
- 统一的DTO封装 (`ParamsDto` / `ReturnDto`)
- 完整的Swagger文档
- 标准化的错误处理

---

## 💡 **开发提醒**

⚠️ **在开发新功能时，请始终检查是否可以复用上述基础设施组件，避免重复开发！**

*最后更新: 2025-01-XX*