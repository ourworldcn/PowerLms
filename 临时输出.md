```markdown
# 会议备忘录（基于转录整理）

## 1. 👥 参会与背景
1.1 主要发言人/参与人（按转录出现）
- `永昌 石`
- `ZC@WorkGroup`
- `云霄 陈`
- 其他：提到“郭总”“网管”“西安的人/西安行政”等（未在转录中逐一出现实名/发言）

1.2 会议背景与临时事项
- `ZC@WorkGroup`提到：后天大概就能出院（与会议本身无关的近况信息，但在转录中出现）。

## 2. 🧪 项目推进：西安团队介入与测试启动
2.1 当日进展
- 西安这边人员“全部介入”并开始测试。
- 已为西安人员准备好“用户名”，并且“每个人也登录了”。

2.2 测试方式与测试流程（从业务端到端跑通）
- 第一步：每个人先“建一个业务/接业务”，从头到尾走完整流程。
- 基础资料：暂时由“网管”负责设置。
- 规模：大概约10人左右介入，属于“全面测试开始”。

2.3 数据准备方案的讨论点（待确认）
- 网管、郭总、西安人员正在开会确认：
  - 方案A：拿“25年某一个月业务量比较少的业务”集中录入，走一遍系统。
  - 方案B：将“26年1月份的数据给齐”，并与单机版一起“变形/对照”做一遍操作。
- 结论：尚在商量；确认后开始完整跑系统。

## 3. 🧰 协作工具：Teams账号/会议工具选择
3.1 Teams会员/账号问题
- `ZC@WorkGroup`询问“Teams的会员搞定了吗？”
- `永昌 石`答复：没搞定。
- `ZC@WorkGroup`表示可以拉他进来开一个Teams房间供沟通使用，不需要单独购买。

3.2 临时采用工具
- `永昌 石`说明：暂时用“腾讯会议”。
- 认为腾讯会议：现在可以进、免费、可以记录会议纪要（即使只是简单纪要也可以）。

3.3 其他评论（与项目决策相关的主观评价）
- `ZC@WorkGroup`反馈微软账号系统越来越复杂，配置半天搞不定。
- 讨论到国内工具/大模型后续可能更多免费，钉钉也可能出免费版，可能比微软好用。

## 4. 🐞 缺陷清理与测试环境约束
4.1 总体目标
- 继续尽快清理剩余bug。
- 西安开始使用后，遇到的问题会更“着急”，反馈催得紧。

4.2 环境说明
- 当前西安团队使用“测试环境”。
- 不使用开发环境原因：开发环境数据太乱。
- 测试环境数据目前保留为“他们的数据”，暂时未动。

4.3 bug清单的协同方式（转录中的断点信息）
- 提到“第6个”需要先加上并再看一下（具体条目未在转录中给出原始列表内容）。
- 对于“没加的功能”：前后端都有涉及，建议后端先改、前端再加。
- “日期/时间搜索默认范围”相关：
  - `永昌 石`认为属于前端。
  - `ZC@WorkGroup`提到“前端后端默认一周”。
  - `云霄 陈`解释：前端希望点“一天范围”就是一天，“一周范围”就是一周。
- 对照清单检查是否还有没清的：需要后端改的让前端/测试人员提出来。

4.4 “已删除”相关控件改造的影响
- `云霄 陈`说明：
  - “已删除”的使用点比较多，改起来不会很快。
  - 很多旧地方不是新控件，需要逐步改成新控件。
- `永昌 石`补充：短时间内“看不出来要删除”，可能要用几个月后才会出现客户删除等情况，短期不会。

## 5. 🔐 权限/角色相关：set rules问题定位与结论
5.1 初始现象
- 提到“set rules”相关问题：`ZC@WorkGroup`说“我改了”。
- 现场测试时出现：
  - “保存没保存上，而且还给清空了”。
  - “删了一个就没了，所有的没了”。
  - “加了一个把3个都清掉了”。
  - 页面提示“操作成功”，但原有3个角色没了。
  - 需要关页面再打开/重新登录查看。
- 过程中提示：要找“没角色的”用户测试；并提醒直接在测试环境操作容易把数据搞乱（但`永昌 石`认为没事）。

5.2 可能原因讨论（接口与逻辑）
- `ZC@WorkGroup`表示：已查过本身没毛病，改了缓存；询问是从哪个接口读出来不对。
- `云霄 陈`回答：读的是“user那个get…接口叫get二”（口误/识别误差），并推测在`Account`控制器下。
- 围绕“set rules是否只是查询接口返回不正常”产生争论：
  - 一方认为是查询接口；
  - 一方认为是设置逻辑：设了3个被清掉，但没加回去；
  - `云霄 陈`提到：无论删还是加，结果都是清掉了。

5.3 set rules内部逻辑的复述（关键）
- `永昌 石`推测：set rules逻辑可能是：
  - 第一步清空（成功）
  - 第二步添加（未成功）
- `ZC@WorkGroup`补充：里面有两步：先查已有的、再做集合运算，可能集合运算被弄混，准备把它搬到管理器里（“管理器”字面出现）。
- `ZC@WorkGroup`认为这是非一般性问题，可能笔误或很古怪的问题，已记下准备再查。

5.4 最终“破案”与结论（确定性结论）
- `ZC@WorkGroup`在现场拦截参数后发现：
  - 前端传参字段写错：不是`rules`而是`ruleIds`（转录中明确指出“不是rules，而是rule IDs”）。
  - 因为前端给了不存在的值，后端不报错但集合为空，所以执行清空逻辑导致角色被清空。
- 结论：set rules问题“放在前端解决”，前端修正参数字段即可。
- `永昌 石`补充：前端“缺了个i”（指ruleIds拼写/字段拼写错误的细节）。

## 6. 🔍 权限未生效：查看所有申请单（需求确认与实现归属）
6.1 问题描述
- “查看所有申请单的权限”没有起作用；不确定是前端还是后端限制。

6.2 业务期望（权限效果）
- 正常情况（未授予权限）：用户只能看“我自己申请过的申请单”。
- 授予权限后：可以查“公司范围内所有申请单”，且“不限流程”。
- `ZC@WorkGroup`确认：一定会限定在公司范围内。
- `ZC@WorkGroup`评价：查询做得不够规范化，可能存在问题，但`永昌 石`认为暂时不影响使用（影响在“查询范围”）。

6.3 谁来做限制的讨论
- `云霄 陈`认为：应由后端限制，因为涉及“同部门/公司级别”等前端无法可靠判断。
- `ZC@WorkGroup`提到：权限可能已改成“个人/部门/公司”三个级别。

6.4 需要进一步澄清的点（转录中未完全落地）
- “能看所有申请单”的入口/节点：是在申请审批位置还是其他位置，转录中提到需要确认“在哪个节点上才有”。

## 7. 💰 功能讨论：结算拆分金额（按收支拆分的方案）
7.1 现状与来源（单机版痛点）
- 单机版存在bug：申请单明细在结算时无法细到“某一个费用”的层级；明细挂的是“申请单”而不是“申请单明细”。
- 结果：
  - 拆分结算后，无法区分“哪个公众号的哪些费用已结/未结”。
  - 在公众号维度统计“谁欠钱、欠哪个公众号的什么费用”时统计不出来。

7.2 现有系统已完成的改造（关键成果）
- 目前系统已将明细“拆分到原子级别”（把一个费用作为最小原子单位）。
- 因而可以精准控制：哪个公众号的报关费/叉车费结了多少、没结多少。

7.3 新问题：收支混合（“轧差/嘎查”）场景的拆分困难
- 存在“有收入也有支出在同一结算单”出现导致拆分麻烦。
- 大多数拆分是单一方向（全收入或全支出），但不排除混合场景。

7.4 方案讨论：收支分开拆（核心决策方向）
- 对于“全部收入”或“全部支出”的申请单：
  - 只要按正数处理，拆分时“把金额凑够即可”，不需要做差值求和。
- 对于“混合收支（轧差）”的申请单：提出两种处理思路/规则：
  - 方案1（偏简化）：只从收入里拆，例如收入合计200、支出合计100、结算单净额100，要拆出50时，直接从收入200中挑出50，支出全部剔除。
  - 方案2（显式收支拆分）：允许用户分别填写“收入拆多少、支出拆多少”两个值（两个框），用户自行算（例如收入挑80、支出挑30）。

7.5 UI/交互建议（与实现方式绑定）
- 页面提供两个输入框：`拆分收入金额`、`拆分支出金额`。
- 智能锁定规则：
  - 只有收入：锁住支出输入框；只允许填收入。
  - 只有支出：锁住收入输入框；只允许填支出。
  - 轧差混合：两个输入框都放开，由用户自行填写。
- 可增加“预览”能力：
  - 预览拆分后清单，让用户看到“哪些费用被拆走/不再出现”。

7.6 会议现场达成的临时结论
- `永昌 石`提出“收支单独拆分”的写法与方案。
- `云霄 陈`认可可行：即使底下表展示在一起，处理逻辑也会分两块。
- 达成：先按该方案解决（先解决实际问题，好不好用后续再说）。
- 后续：不确定的点后面微信再问。

## 8. 📅 后续会议与沟通机制
8.1 下次会议安排
- 周六正常开会。

8.2 沟通机制建议
- 人多担心传话传错：建议建“大群/大组”，直接把问题说出来，避免多次转述导致偏差。
- 也支持：先让AI整理会议内容给大家，减少沟通偏差。
- 目前现状：网管与`永昌 石`单线联系，偶尔截群图反馈；`永昌 石`形容像“特务接头一样单线联系”。
- 结论：若沟通不清晰再拉大群。

## 9. ✅ 明确行动项（从转录抽取）
9.1 前端
- 修正 set rules 提交参数字段：使用`ruleIds`而非`rules`（并检查拼写缺失`i`的问题）。
- 时间搜索默认范围/快捷切换（一天/一周）相关：前端按需求实现（并确认是否需要前后端一致默认一周）。

9.2 后端（待进一步确认/排查）
- “查看所有申请单”的权限限制逻辑需确认并落地（倾向后端限制；范围通常为公司/部门/个人三级）。

9.3 产品/业务规则（需明确给开发）
- 结算“按收支拆分”的规则最终落版：
  - 全收入/全支出：单框输入，另一框锁定。
  - 轧差混合：两框输入，用户自行计算；提供预览。
- 明确“查看所有申请单”的入口、节点与权限项定义。

9.4 测试组织
- 西安测试数据准备方案A/B由网管/郭总/西安团队会议确认后推进。
- 测试环境继续保持数据稳定，避免随意操作导致数据混乱。
```