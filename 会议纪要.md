# 会议详细记录与任务清单 (完整版)

---

## 主题一：权限、流程与现有Bug修复

### 永昌 石 (产品/项目经理)
*   **权限澄清**:
    *   **决议**: 明确指出“日常费用申请”这一主菜单项所有人可见，但其下的子功能“结算”与“确认”需要通过权限系统进行控制。
*   **Bug复现与演示**:
    *   **操作**: 现场演示了在草稿状态下编辑申请单（如修改备注），点击保存后，虽然前端弹出“成功”提示，但数据并未实际保存到数据库。
*   **锁定规则定义**:
    *   **决议**: 申请人一旦点击“提交”使单据进入审批流程，主表单的所有信息（基本信息、总金额、附件等）即被视为最终版本，任何人都不能再修改。这个规则要与主营业务申请单的逻辑保持一致。

### 云霄 陈 (前端开发)
*   **Bug排查**:
    *   **操作**: 指导“永昌 石”使用浏览器开发者工具（F12）检查网络请求，确认在保存草稿时，前端已将修改后的数据（如新的备注内容）正确地包含在发往后端的`payload`中。
    *   **判断**: 基于上述操作，判断“编辑保存失败”是后端问题。
*   **任务**:
    *   **前端锁定实现**: 负责在前端界面实现：一旦单据状态变为“审批中”，所有主表单的输入框和控件都应变为只读（disabled）状态。
    *   **组织机构字段适配**:
        *   **背景**: 后端`Org`实体的数据结构已从`{ "name": { "displayName": "xxx" } }`的嵌套形式，修改为`{ "name_displayName": "xxx" }`的扁平化形式。
        *   **任务**: 需要在前端代码中，全局搜索所有用到`org.name.xxx`的地方，并将其修改为新的扁平化字段，以确保组织机构选择和显示功能恢复正常。这项修改工作量可能较大，因为`.name`的用法在代码中很普遍。
    *   **开票信息字段校验**:
        *   **决议**: “开户行”和“开户行账号”这两个字段应为**非必填项**。
        *   **任务**: 修改前端页面的表单校验逻辑，移除对这两个字段的必填验证。

### ZC@WorkGroup (后端开发)
*   **任务**:
    *   **Bug修复**:
        *   **定位**: 确认接收到前端发送的正确数据，但未能成功写入数据库。
        *   **行动**: 记录此Bug，承诺会后修复“修改OA备用申请单”接口的保存逻辑。
    *   **后端数据锁定**:
        *   **行动**: 修改后端逻辑，对所有处于“审批中”或之后状态的单据，在执行更新操作时，增加一层验证，拒绝任何对主表单字段的修改请求，确保数据安全。
    *   **财务导出接口开发**:
        *   **背景**: 此功能客户已催促。
        *   **行动**: 承诺在本周内，完成两个“财务单据导出”接口的开发。

---

## 主题二：“主营业务结算单”功能深度改造

### 永昌 石 (产品/项目经理)
*   **需求文档讲解与修订**:
    *   **字段命名**: 主导将“凭证号”更名为“收付单号”，并新增一个独立的“财务凭证号”字段。
    *   **字段逻辑统一**:
        *   **决议**: 主导讨论并明确了“是否导出到财务软件”字段的含义。它是一个**控制开关**（允许/禁止导出），而不是一个**状态记录**（已导出/未导出）。其默认值应为`True`（默认允许导出），因为不导出的情况是少数。
        *   **行动**: 在Excel文档中，将该字段的名称统一为“是否导出到财务软件”，以消除歧义。
    *   **动态字段标注**:
        *   **背景**: 结算单上的部分字段标签会根据“收款”或“付款”状态动态变化（例如，“收款合计”/“付款合计”）。
        *   **行动**: 在Excel文档中，使用“收/付款合计”这样的斜线格式来清晰标注这些字段，明确它们在后端对应同一个数据库字段。
    *   **字段显隐规则**:
        *   **决议**: “实收金额”和“实收金额本位币”这两个字段仅在“收款单”中显示。
        *   **行动**: 在Excel文档中，对这两个字段进行特殊颜色标记（如标红），并备注其显示条件。
    *   **非实体字段说明**:
        *   **背景**: 表格底部的“核销金额”和“核销金额本位币”是用于最终导出到金蝶的计算字段，不需要在数据库中持久化。
        *   **行动**: 在Excel文档中，将这2个字段移至备注列，明确它们不是实体字段，以避免后端开发时产生误解。
    *   **精度规则**:
        *   **决议**: 整个系统中，所有**金额**字段保留**两位小数**，所有**汇率**字段保留**四位小数**。

### ZC@WorkGroup (后端开发)
*   **任务**:
    *   **实体与数据库变更**:
        *   **行动**: 负责在后端的`主营业务结算单`实体中，增加Excel文档里所有标记为新增的字段（约13个），并完成相应的数据库表结构变更。
    *   **新增通用子表**:
        *   **设计**: 设计一个通用的`实际收付记录表`，用于处理一笔结算分多次收/付款的场景。此表将通过一个通用的`ParentId`与其他任何主单据关联，而不仅仅是结算单。
        *   **行动**: 创建该数据表，并提供一套完整的CRUD（创建、读取、更新、删除）API接口供前端调用。
    *   **新增计算工具接口**:
        *   **背景**: 为确保前后端对于“核销金额”等复杂计算的算法完全一致，避免因浮点数精度问题导致1分钱的误差。
        *   **设计**: 创建一个独立的、无状态的工具类API接口。该接口接收计算所需的所有原始值（如金额、汇率列表等）作为参数，返回计算结果。
        *   **行动**: 实现该计算接口，确保其逻辑与未来导出金蝶的算法一致。

### 云霄 陈 (前端开发)
*   **任务**:
    *   **界面重构与适配**:
        *   **行动**: 根据更新后的Excel文档，重构“主营业务结算”的前端界面，添加所有新增字段。
        *   **行动**: 实现字段标签的动态变更（收/付）和字段的动态显隐（如“实收金额”仅收款时显示）。
    *   **核心交互功能实现**:
        *   **“折算汇率相同”按钮**:
            *   **逻辑**: 当用户在明细列表的某一行输入一个新的“结算汇率”后，点击此按钮。前端需要获取当前行的**币种**，然后遍历整个明细列表，将所有**相同币种**的行的“结算汇率”全部更新为用户输入的新值。这个过程需要用户**手动点击按钮触发**，不能在用户输入时自动触发，以确保操作的确认性。
        *   **“多笔收付款”子表**:
            *   **逻辑**: 提供一个按钮（如“多笔收付款记录”）来控制子表的显示和隐藏。
            *   **新增行逻辑**: 当用户在子表中新增一行时，需要自动计算剩余金额并填充。计算公式为：`主表总金额 - 已录入子表明细的金额之和`。
            *   **编辑逻辑**: 用户可以修改子表中的任何金额，包括自动计算出的最后一行。修改后，不再进行自动联动计算。
            *   **校验逻辑**: 在用户保存或离开页面时，必须校验子表中所有行金额的总和是否等于主表上填写的“收付金额”。如果不等，必须弹出提示，阻止保存或提醒用户数据不平。
        *   **手动触发计算**:
            *   **逻辑**: 对于界面上存在公式关联的字段（如 `A = B - C`），当用户需要系统自动计算时，可通过双击A字段的输入框来触发。如果用户不双击，则可以手动输入任何值，系统以手动输入为准。
            *   **行动**: 实现这种双击触发计算的交互模式。
    *   **接口调用**:
        *   **行动**: 对接后端新增的`实际收付记录表`的CRUD接口。
        *   **行动**: 在需要显示“核销金额”等计算值时，调用后端提供的**计算工具接口**，并将结果展示在界面上，确保显示结果与后端导出时的数据完全一致。

---

## 主题三：项目背景、挑战与规划

### 永昌 石 (产品/项目经理)
*   **信息同步**:
    *   **客户压力**: 明确传达了客户股东因项目投入两年，但新系统的用户体验和功能完善度尚未超越旧版单机软件而感到焦虑。
    *   **项目价值主张**: 重申了项目的核心价值在于：
        1.  **集中化管理**: 打破9个分公司的信息孤岛，实现集团层面的数据互联互通和统一报表。
        2.  **成本削减**: 取代9个本地机房，大幅降低硬件维护和场地租赁成本。
        3.  **数据安全与电子化**: 将所有纸质单据电子化并云端存储，避免因火灾等物理灾害造成的数据丢失。
    *   **下阶段计划**:
        *   **并行测试**: 9月起，选取廊坊和西安两个分公司进行为期3个月的并行测试。测试期间，两套系统同时录入真实业务数据，月底必须保证两边出的报表数据完全一致。
        *   **推广前提**: 只有在小分公司数据完全验证无误后，才会考虑在北京、上海、广州这三个核心分公司推广。

### ZC@WorkGroup (后端开发)
*   **策略建议**:
    *   **差异化竞争**: 提出不应与单机版拼凑功能细节，而应突出新系统的核心优势。
    *   **打造亮点**: 建议快速开发一个能体现“互联互通”价值的亮点功能，例如一个给老板看的“集团KPI总览仪表盘”，让他能随时随地看到所有分公司的关键业务数据，直观感受新系统的价值。
*   **风险提示**:
    *   **调试周期**: 提醒团队，根据经验，如此规模的系统在功能开发完成后，通常还需要至少半年的上线调试、Bug修复和反复优化才能真正稳定。

### 云霄 陈 (前端开发)
*   **挑战分析**:
    *   **用户习惯**: 认为用户的负面反馈很大程度上源于对旧单机软件操作习惯的依赖，改变用户习惯需要时间和优秀的设计。
    *   **技术差异**: 指出Web技术在模拟单机软件特有的流畅键盘操作（如全键盘`Tab`键跳转、回车计算等）方面存在天然的技术挑战和复杂性。