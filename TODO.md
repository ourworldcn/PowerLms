# 📋 待办任务清单

## 1. 🔥 紧急任务（周末必须完成）

### 1.2 缓存机制导致的全局性系统错误
- **问题描述**: System.InvalidOperationException 不定时出现
  - ModifyCustomer 设置客户为无效时报错
  - GetAllCustomer 查询客户列表时报错
- **根源分析**: 底层缓存机制重构后，组织机构过滤存在缺陷
- **影响范围**: 全局性、间歇性错误，影响周一客户流程测试
- **负责人**: ZC@WorkGroup
- **状态**: ⏳ 进行中

---

## 2. ⚡ 高优先级任务（尽快完成）

### 2.1 费用金额回写不正确
- **问题描述**: 费用的"已申请金额"和"已结算金额"回写不稳定（翻倍/为0/正确）
- **根源分析**: 数据库触发器不稳定，第三方框架移除后引用关系存在问题
- **解决方案**: 废弃触发器，改为代码层面处理回写逻辑
- **负责人**: ZC@WorkGroup
- **状态**: ⏳ 待处理

### 2.2 角色权限设置失败（setRoles）
- **问题描述**: setRoles 接口返回成功，但 GetAllAccountRole 查询不到设置的角色
- **代码审查结果**: ✅ **后端逻辑正确，无BUG**
- **可能原因**: 前端问题（未刷新列表/缓存）或查询条件错误
- **验证步骤**: 前端F12查看请求响应 → 直接查询数据库 → 检查前端缓存
- **负责人**: 云霄 陈 (前端排查)
- **状态**: ⏳ 待前端验证

---

## 3. 📌 普通优先级任务（按计划处理）

### 3.2 结算时金额做"余额式计算"
- **需求描述**: 结算拆分时智能填充金额
- **负责人**: 云霄 陈
- **状态**: ⏳ 待处理

### 3.3 控制申请/结算金额不超过原始金额
- **需求描述**: 后端校验申请/结算总额不超过费用金额
- **负责人**: ZC@WorkGroup
- **状态**: ⏳ 待处理

### 3.4 结算单核销金额合计
- **需求描述**: 结算单核销金额、核销金额本位币合计
- **负责人**: 待定
- **状态**: ⏳ 待处理

### 3.5 后端日常费用申请单数据获取问题
- **问题描述**: 获取数据不正确，查询不到明细
- **负责人**: ZC@WorkGroup
- **状态**: ⏳ 待处理

---

## 4. 🔻 低优先级任务

### 4.1 操作案例（BBS）前端开发
- **负责人**: 云霄 陈
- **状态**: ⏳ 待处理

---

## 5. ✅ 已完成任务（后端）

### 5.1 移除缓存中实体的DbContext属性（架构改造）
- **完成时间**: 2025-01-15
- **负责人**: ZC@AI协作

### 5.2 组织树延迟加载冲突修复
- **完成时间**: 2025-01-28
- **负责人**: ZC@AI协作

### 5.3 日常费用申请单增加"申请编号"字段
- **完成时间**: 2025-01-28
- **负责人**: ZC@WorkGroup

### 5.4 商管看不见其他商管账户
- **完成时间**: 2025-01-28
- **负责人**: ZC@AI协作

### 5.5 GetAllCustomer 权限验证临时注销
- **完成时间**: 2025-01-28
- **负责人**: ZC@WorkGroup
- **备注**: 临时方案，已记录为技术债务

---

## 6. 📝 测试流程清单

### 6.1 主营业务流程
建委托（工作号）→ 建费用（检查费用方案）→ 账单（检查合计金额）→ 申请单（检查合计金额、费用已申请金额、添加移除明细、余额）→ 审批流程 → 收入开发票 → 结算单（检查各合计金额、费用已结算金额）→ 结算单确认 → 工作号审核 → 关账（账期结转）→ 财务接口

### 6.2 日常费用流程
建申请 → 审批 → 拆分结算 → 结算确认 → 财务接口

---

## 7. ⚠️ 已知问题与待确认事项

### 7.1 主营业务收入审批无法选择下一审批人
- **原因**: 未配置流程
- **状态**: 待确认

---

**最后更新**: 2025-01-28
**优先级说明**: 🔥紧急 > ⚡高优先级 > 📌普通 > 🔻低优先级