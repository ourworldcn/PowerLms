# 📋 PowerLms 待办任务清单

## 🔥 本周任务（服务器端）

### 1. 基础数据刷新优化
- **任务**：字典/港口信息自动刷新周期调整
- **详情**：将自动刷新周期从5分钟调整为1小时，减少90+MB数据频繁加载导致的卡顿
- **保留功能**：主动刷新入口，用户可手动刷新或重新登录获取最新数据

### 2. 申请单状态刷新问题修复
- **问题**：申请单批复完成后页面状态未刷新，导致仍可编辑
- **需要**：定位复现场景，修复状态刷新逻辑

### 3. 发票申请字段自动填充
- **问题**：发票申请选择购买方抬头后，推送手机号和Email未自动带出
- **需要**：检查字段映射/绑定逻辑，确保地址信息带出时同时带出联系方式

### 4. 费用批量处理功能
#### 4.1 批量审批/批量审核费用
- **状态**：此功能之前可能漏做或入口被删除
- **需要**：确认功能是否已实现，如未实现需补充开发

#### 4.2 批量生成账单（新增）⭐
- **功能**：批量审核费用后，增加"批量生成账单"功能
- **场景**：当出现67个单位费用时，避免一笔一笔手动新建账单
- **实现要点**：
  - 点击"批量新增账单"后，自动为所有未建账单的费用创建账单
  - 必填字段最少化：结算单位/付款人、自动账单号、币种
  - 字段自动带入：从业务基本信息带入（到稿日期、货物名称、件数等）
  - 币种默认：默认设为"人民币"（防卫B），后期可手动修改
  - 目标：一键保存完成机械动作，无需人工干预

### 5. 空运出口主单制作（后端）⭐⭐⭐
- **数据存储**：纯展平/快照模式，前端传什么存什么，无额外校验逻辑
- **子表数量**：4个子表（主单特有）
- **自动费用**：主单需自动生成9个费用项
- **菜单挂载**：空运出口 -> 主单领用登记（3级菜单）-> 新增"主单制作"
- **权限配置**：确保菜单权限正确赋予

### 6. 空运出口分单制作（后端）⭐⭐⭐
- **关系**：附属于主单下面
- **与主单差异**：
  - **更简单**：字段和逻辑比主单少
  - **少的内容**：英文品名（仅保留中文品名）
  - **多的内容**：
    - 分单号/封单号字段
    - 其他编码规则字典（营销需要）
  - **子表数量**：2个子表（其他费用、委托明细）
  - **无自动费用**：不需要自动添加费用项
- **数据存储**：纯展平/快照模式，前端传什么存什么，无额外校验逻辑
- **菜单挂载**：空运出口 -> 主单领用登记（3级菜单）-> 新增"分单制作"（与主单制作并列）
- **权限配置**：确保菜单权限正确赋予

---

## 📌 说明
- 主单和分单的打印套打功能由前端负责（底图+字段定位）
- 本周重点：服务器端数据结构、存储逻辑、业务接口开发
- 前端主单完成后可复制改造为分单

