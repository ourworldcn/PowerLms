# PowerLms 变更日志

## [未发布] - 2025-01-XX

### 业务变更（面向项目经理）

#### 数据导入导出功能增强
* 修复了导入导出功能的错误处理逻辑，配置错误现在能立即提示，避免静默失败
* 修复了PlCustomer客户主表被误归类为字典表的问题，现已正确归类为客户资料表

#### 客户资料管理优化
* 中文地址字段扩容：客户详细地址从64字符扩展到256字符，支持更长的地址信息录入
* 英文地址优化：优化了英文地址的存储和验证机制，提升数据质量和存储效率

#### 用户切换公司功能修复
* 修复了切换公司后机构信息显示为空的问题，确保用户切换组织机构后能立即看到正确的机构详情信息

### API变更（面向前端）

#### 数据导入导出接口优化

影响的API：
* POST /api/ImportExport/ImportMultipleTables 批量导入表数据
* GET /api/ImportExport/ExportMultipleTables 批量导出表数据

修复内容：
* 修复了PlCustomer表被错误归类的问题，现在导入导出客户资料时不会再提示"不支持的表类型"
* 改进了错误提示信息，配置错误时会立即抛出异常并提示具体原因，不再静默失败返回0条记录
* 统一了导入导出的错误处理逻辑，确保行为一致

影响范围：
* 前端无需修改代码，错误提示更加友好明确
* 如果遇到不支持的表类型，会明确提示"不支持的XX类型: YY，这可能是配置错误"

#### 用户切换公司接口修复

修改的API：
* PUT /api/Account/SetUserInfo 设置用户信息

问题描述：
* 用户调用SetUserInfo切换公司(CurrentOrgId)后，再次获取机构详情时name_Name字段返回null

修复内容：
* 切换公司后系统现在会自动刷新组织机构缓存，确保立即获取到最新的机构信息
* 不影响现有API调用方式，无需前端适配

影响范围：
* 解决了"已经使用百子2这个组织登录了，再用这个组织机构获取机构详情，返回的name_Name字段为null"的问题
* 提升了用户切换公司后的数据一致性和响应速度

#### 客户资料接口增强

修改的API：
* POST /api/Customer/AddCustomer 创建客户
* PUT /api/Customer/ModifyCustomer 修改客户信息

字段长度调整：
* Address_Address（详细地址）：64字符 → 256字符
* EnglishAddress（英文地址）：新增ASCII字符验证，只允许字母、数字、空格和标点符号

前端适配建议：
* 中文地址输入框可增加字符计数显示（最大256字符）
* 英文地址输入时建议添加实时验证提示
