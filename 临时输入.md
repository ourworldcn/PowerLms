会议备忘录
会议时间：2026-02-08
目录
主单/分单业务逻辑与计算
主单/分单 UI/UX 优化与 Bug修复
新功能规划：「进口仓单」
后续工作安排
待办事项清单
1. 主单/分单业务逻辑与计算
1.1 委托明细自动计算
体积计算：根据提供的公式，在主单编辑时，委托明细中的“体积”需要根据“长、宽、高”自动计算。公式为：(长 * 宽 * 高 * 件数) / 1,000,000 或 (长 * 宽 * 高 * 件数) / 6000 / 166.67。单位为厘米。
抛重计算：公式为 (长 * 宽 * 高 * 件数) / 6000。
主表数据汇总：委托明细中的“体积”和“重量”的总和，需要自动合计并更新到主单主表对应的“体积”和“重量”字段。
1.2 “其他费用”计算逻辑
背景：主单中有“其他费用”的付款方式（字段77），分为预付(PP)和到付(CC)。
逻辑：
如果付款方式（字段77）为 PP (预付)，则将“其他费用”子表的总金额合计值填入主表的“其他费用-PP”字段（字段111），同时“其他费用-CC”字段（字段112）置空。
如果付款方式（字段77）为 CC (到付)，则将“其他费用”子表的总金额合计值填入主表的“其他费用-CC”字段（字段112），同时“其他费用-PP”字段（字段111）置空。
此逻辑同样适用于分单。
1.3 分单“其他费用”子表处理
决策：与主单不同，分单在创建时不自动添加默认的9个费用项。子表为空，让用户手动添加。
2. 主单/分单 UI/UX 优化与 Bug修复
2.1 主单编辑页面布局优化
问题：主单编辑页面过长，导致保存、编辑等操作按钮需要滚动到页面底部才能看到，用户体验不佳。点击编辑后，提示信息出现在屏幕中央，但用户可能因视口未滚动而无法看到。
解决方案探讨：
悬浮按钮栏：将顶/底部的操作按钮栏（增、删、改、保存等）设置为悬浮(fixed)，使其在页面滚动时始终可见。
内容区滚动：将页面主体内容（表单字段）放置在一个固定的容器内，只允许该容器内部滚动，而顶部的操作按钮和标题栏保持不动。（此方案被认为是理想状态）
Tab页切分：将长页面按逻辑块（如发货人信息、费用、集装器等）切分为多个Tab页。但因字段间存在联动，此方案实现较为复杂，暂不优先考虑。
决策：优先研究“内容区滚动”方案的可行性。
2.2 部分子表改为弹窗（模式窗口）
需求：为缩减主单页面的初始长度，“品名”、“集装器”这两个部分默认不显示。
实现：在页面上增加按钮，用户点击后通过弹窗（模式窗口）的形式来编辑这些信息。
2.3 Bug修复与小调整
通知提示位置：操作后的成功/失败提示信息应显示在屏幕可视区域的中央，而不是整个页面的中央。
国家字典：
列表和录入/编辑界面均需增加“备注 (Remark)”字段。
修复BUG：点击“国家”字典的编辑按钮时，弹窗标题错误地显示为“币种”。
费用申请路径：该项为后端修改，前端需进行相应变更。
3. 新功能规划：「进口仓单」
3.1 业务背景与定义
定义：进口仓单是用于海关报关的数据，它是由**出口方**的主分单信息中提取一部分关键数据生成的。
监管单位：主分单的主管单位是航空公司（作为货代与航司的合同）；而仓单的主管单位是海关的仓单科。
流程：
��物从国外起飞后，出口方代理将仓单数据传给国内（进口方）。
进口方货代系统接收/录入仓单数据，用于后续向海关申报。
货物到港后，货代需进行理货、入库等操作，并将“运抵时间”、“理货时间”、“入库时间”等状态回传给海关仓单科。
海关将航空公司的舱单与货代的报关单进行核对，一致后放行。
系统定位：本期先实现仓单数据的CRUD（增删改查）和手动录入功能。未来计划与海关的仓单科系统进行API对接，实现数据自动下载和状态回传。
3.2 数据模型与关键字段
主表 (Manifest)：包含航班号、航班日期、申报地海关、主单号等。
子表 (Manifest Details)：包含主单号、分单号、收发货人名称、包装方式、件/重/体、以及运抵/理货/入库等多个时间戳。
主单号 (MAWB) 格式：
仓单系统中的主单号是11位纯数字，没有横杠或空格。
这与航空公司标准的带前缀和横杠的格式 (如 001-12345678) 不同。
**处理方式**：系统应**原样记录**仓单科给的11位数字主单号，以备核对。在需要生成内部工作号或与其他模块关联时，再进行格式化（如加上横杠）。
时间精度：仓单操作的各个时间点（如运抵、理货、入库）需要精确到**分钟**。字段值为空代表该状态尚未发生。前端通过勾选框触发记录当前时间。
3.3 校验与关联逻辑
主分单识别：在子表（明细）中，通过“分单号”字段是否为空来区分主单行和分单行。
“分单号”为空的行，代表主单信息。
“分单号”不为空的行，代表分单信息。
数据一致性校验 (手动录入时)：
一个主单号下的所有分单行的“件数”、“重量”等数据之和，应等于主单行的对应数据。
所有行（无论主单还是分单）都必须有主单号。
后端在保存时，可将仓单科传入的原始主单号作为显示字段，同时内部通过标准化转换，校验主单是否存在，并用GUID建立后台关联。
直单 (Direct Bill)：指没有分单，只有主单的情况。在子表中表现为只有一行数据，且该��的“分单号”为空。
工作号生成：提供“生成工作号”功能，利用仓单信息（主单号、收发货人等）预填内部工作号的字段，减少重复录入。
4. 后续工作安排
接口开发：后端（ZC@WorkGroup）将在11号或12号前完成仓单功能的API开发。
前端开发：前端（陈云霄）继续完成主分单制作，然后搭建仓单的CRUD界面。
后续会议：因临近春节假期，下次会议安排在年后（暂定21号，破五之后）再碰头讨论海运及更复杂的报关单模块。
5. 待办事项清单
类别	任务描述	负责人
后端	1. 在主单/分单业务中，实现基于付款方式(PP/CC)的“其他费用”合计逻辑。	ZC@WorkGroup
后端	2. 创建“进口仓单”的主表和子表实体及CRUD接口。	ZC@WorkGroup
后端	3. 在仓单子表录入时，增加主分单数据一致性的校验逻辑。	ZC@WorkGroup
后端	4. 提供国家字典表的“备注”字段支持。	ZC@WorkGroup
前端	5. 实现主单委托明细中“体积”、“抛重”等字段的自动计算。	陈云霄
前端	6. 将主单编辑页的“品名”、“集装器”部分改为弹窗形式。	陈云霄
前端	7. 优化主单长页面的滚动体验（研究容器内滚动或悬浮按钮栏方案）。	陈云霄
前端	8. 修复各处操作提示信息未在可视区居中的问题。	陈云霄
前端	9. 在国家字典的列表和录入界面增加“备注”字段，并修复编辑时标题错误的Bug。	陈云霄
前端	10. 移除分单“其他费用”子表的默认9个费用项。	陈云霄
前端	11. 搭建“进口仓单”功能的CRUD界面。	陈云霄