# 📋 后端开发任务清单（2025-12-27会议）

**会议日期**: 2025年12月27日  
**负责人**: ZC@WorkGroup  
**来源**: 积压Bug清理与问题讨论会议

---

## 1️⃣ 客户资料删除限制功能

### 1.1 📌 任务概述
**优先级**: 🔴 高  
**模块**: 基础资料 - 客户管理  
**问题**: 已有关联业务的客户资料可被物理删除，导致数据完整性问题

### 1.2 🎯 业务规则
- **允许删除**: 刚创建未被任何业务单据引用的客户资料
- **禁止删除**: 已被费用、订单等业务单据引用的客户资料
- **替代方案**: 对已引用客户，只能设为"无效"状态（软删除）

### 1.3 🔧 技术实现要点
- 在删除操作前执行引用检查
- 遍历相关业务表（费用、订单、结算单等）
- 检测是否存在外键引用
- 引用存在时返回错误提示，阻止物理删除
- 提示用户使用"设为无效"功能

### 1.4 📝 实现步骤
1. 在客户资料Manager中添加删除前置检查方法
2. 查询所有可能引用客户资料的业务表
3. 如果存在引用记录，抛出业务异常
4. 在Controller中捕获异常并返回友好提示

---

## 2️⃣ 关账功能逻辑修复

### 2.1 📌 任务概述
**优先级**: 🟡 中  
**模块**: 财务管理 - 关账  
**问题**: 无业务单据的月份无法执行关账操作

### 2.2 🎯 业务规则修正
- **错误逻辑**: 当月无业务单据时禁止关账
- **正确逻辑**: 关账与当月业务量无关，仅用于锁定会计期间
- **核心目的**: 防止用户在已关账期间创建或修改单据

### 2.3 🔧 技术实现要点
- 移除"当月必须有业务单据"的校验逻辑
- 关账操作只需验证账期顺序（不能跳月关账）
- 关账成功后，更新组织机构扩展属性中的"当前账期"
- 确保账期正确向前推进一个月

### 2.4 📝 实现步骤
1. 定位关账功能的Manager方法
2. 删除或注释掉"业务单据数量检查"逻辑
3. 保留账期顺序校验（防止跳月）
4. 确认账期更新逻辑正确执行
5. 测试：连续关账多个无业务月份

---

## 3️⃣ 环境部署任务

### 3.1 📌 任务概述
**优先级**: 🟢 低（等待前端适配）  
**模块**: 运维部署  
**状态**: 开发服务器已部署，等待测试服务器同步

### 3.2 🔄 部署流程
**当前状态**:
- 结算单API路径已变更
- 已部署到开发服务器（调试服务器）
- API变更列表已提供给前端

**待执行**:
1. 等待云霄陈完成前端路径适配
2. 收到前端完成通知后，部署后端到测试服务器
3. 确认前后端在测试服务器联调成功

### 3.3 📋 API路径变更清单
（已提供给前端团队，此处无需后端额外工作）

---

## 4️⃣ 任务执行时间表

### 4.1 ⏰ 元旦节后优先任务
- **客户资料删除限制**: 预计0.5天，无依赖
- **关账功能逻辑修复**: 预计0.3天，无依赖
- **测试服务器部署**: 预计0.2天，依赖前端适配完成

### 4.2 📊 任务优先级说明
- **高优先级**: 涉及数据完整性和业务逻辑正确性
- **中优先级**: 影响正常业务流程但有变通方案
- **低优先级**: 运维类工作，等待外部条件

---

## 5️⃣ 备注说明

### 5.1 ℹ️ 已排除的非后端任务
以下任务由前端团队负责，不在本清单中：
- 拆分结算功能（云霄陈负责）
- 软删除数据前端标注显示
- 费用方案"固定客户"选择框
- 新增操作时空ID参数过滤

### 5.2 🔍 待观察问题
- 日常费用申请页面性能问题：暂时搁置，等待更多用户反馈数据

