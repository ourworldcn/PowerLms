会议备忘录
日期: 2025-11-10

主题: PowerLms 系统核心流程问题跟进会议

参会人员: 永昌 石, ZC@WorkGroup, 云霄 陈

1. 📌 核心问题：基础资料导入失败
问题现象: BUG
用户（小周）反复尝试导入基础资料失败，导致后续工作严重受阻。具体表现为导入数据后，系统中出现大量重复记录，而不是按预期进行覆盖。

调试过程:
石永昌演示了重复导入导致数据从2条变为3条、4条的过程。
团队通过浏览器开发者工具检查网络请求，确认前端在选择“是”覆盖时，传递给后端的参数 isOverride 为 true，前端传参正确。
ZC@WorkGroup确认了后端逻辑应为“删除已存在的”，但实际表现为新增。这被明确为一个后端BUG。
关联问题:
在调试过程中，系统抛出一个红色错误，提示找不到某个“凭证字”（Voucher ACC Catalog）。经排查，发现这是因为“会计科目”中关联的“凭证字”基础数据没有被正确导入，导致查询时出错。这被确认为数据配置问题，而非代码逻辑问题。

结论与负责人:
数据覆盖导入失败是一个后端Bug。
负责人: ZC@WorkGroup

凭证字数据缺失是数据配置问题，可以通过手动补全或修正导入文件解决。
负责人: 永昌 石 (数据配置)

2. ⚙️ 核心流程：申请与审批中的多项严重BUG
高优先级: 此部分涉及的Bug导致核心业务流程（申请、审批）无法正常进行，是本次会议的重点和最高优先级修复内容。

2.1. 已申请金额回写失败 BUG
现象: 提交费用申请后，工作号中对应费用的“已申请金额”字段没有被正确回写。该字段时而为0，时而正确，表现不稳定。
讨论:
团队确认此功能应由后端通过触发器或业务逻辑实现，而非前端计算。
石永昌强调，采用回写方式（持久化存储）优于实时计算，因为前者便于查询和核对，避免了列表接口每次都需要大量计算的性能开销。
ZC@WorkGroup和陈云霄均同意是后端的回写逻辑出了问题。
结论: 这是一个明确的后端Bug，涉及申请单在新增和修改时，未能正确更新关联费用实体的“已申请金额”字段。
负责人: ZC@WorkGroup
2.2. 申请单明细偶发性加载失败 BUG
现象: 打开某些申请单（如#70）的详情页时，其费用明细列表时而显示正常，时而为空白。反复进出详情页，问题会随机复现。
调试: 通过网络请求分析，发现前端调用获取明细的API时，后端有时返回了包含数据的数组，有时返回了空数组 []，但网络请求本身并未报错(200 OK)。这表明问题可能出在后端的数据查询逻辑上，而非前端渲染。
关联现象: 该问题可能与审批流程中断有关。申请单#70的状态显示为“已完成”，但审批流程图上却显示仍有节点挂起未处理，状态不一致。
结论: 这是一个严重的后端数据查询Bug，可能是缓存或数据库查询逻辑导致。需要深入排查。
负责人: 云霄 陈 (前端排查), ZC@WorkGroup (后端核心逻辑)
2.3. 其他申请与审批相关Bug
支出申请单出现发票界面: 已知Bug
在支出申请单中错误地显示了发票相关的UI元素。
负责人: 云霄 陈
新增申请时数据残留: BUG
点击“新增申请”时，弹出的表单会保留上一次查看或编辑的申请单数据，没有被清空。
负责人: 云霄 陈
审批后界面未刷新: BUG
在“待我审批”页面执行审批操作后，当前申请单的状态等信息未在界面上实时刷新。
提交时找不到审批模板/下一节点: BUG
在新建申请并提交时，系统报错，提示找不到对应的审批流程模板（如 OA_exchange_income），导致无法发起审批。这可能是因为前端未正确传递申请类型，或后端模板匹配逻辑有误。
3. 📐 业务规则与财务逻辑讨论
核心规则: 禁止超额申请/结算
“已申请金额”的总和不应超过原始费用的总金额。例如，一笔630元的费用，不能申请或结算超过630元。

特殊情况-负金额:
业务场景: 讨论了负数金额的合理性。例如，航空公司或海关在结算后发布政策性优惠（如每单免200元），为了保证应收账款的准确性（从2000元降至1800元），财务会通过增加一笔负数费用（-200元）来冲账，而不是虚增一笔应付款。
技术要求: 这要求系统必须支持负数金额，并且在校验超额时，应使用金额的绝对值进行比较。
结论: 后端在保存申请单明细时，必须增加严格的校验逻辑：所有关联到同一笔费用的申请明细金额（无论正负）求和后，其绝对值不能超过该笔费用的原始金额的绝对值。 此校验需在后端完成，以防止并发操作导致数据不一致。
负责人: ZC@WorkGroup
4. 🎨 UI/UX 布局与长期规划
用户反馈: 西安的操作人员反馈，希望Web系统的界面布局能尽量靠近旧的单机版系统。核心诉求是将相关字段（如客户信息、港口信息、货物信息）分组并固定位置，以符合他们长期形成的操作习惯。
讨论:
陈云霄解释，当前系统大量使用“通用组件”来根据元数据动态生成表单，这提高了开发效率但牺牲了布局的灵活性。
要实现用户期望的固定式、类似打印单据的布局（如此处展示的香港某系统的航司主单界面），就必须放弃通用组件，为每个页面进行“手写”硬编码，这将极大增加工作量。
ZC@WorkGroup也认为，这种像素级的精确布局调整应放在项目后期。
结论: 暂缓处理。团队一致同意，当前的首要任务是确保核心业务流程畅通无阻。UI布局的定制化改造问题，待流程稳定、用户开始全面使用后再进行评估和排期。
会议最终结论与行动项:

最高优先级: 集中火力修复本次会议中发现的影响核心流程的各项Bug，特别是申请单相关的回写失败、明细加载失败、流程中断等问题。目标是尽快让业务员（小周）能够完整地跑通申请到审批的全流程。
次要优先级: 解决基础资料“覆盖”导入失败的问题。
暂缓处理: UI/UX的布局定制化改造、以及增加保险单、检验检疫等新功能模块的需求，待核心流程稳定后再议。
协作: 陈云霄将保持测试环境数据不变，以便调试审批流相关问题，完成后通知石永昌。